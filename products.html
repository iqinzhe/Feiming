<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>产品系列 - AX Bass&Guitar</title>
  <link rel="stylesheet" href="style.css">
  <style>
    /* 仅产品页独有样式 */
    .series-overview {
      display: grid;
      gap: 25px;
      padding: 30px 5%;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    }
    .model-list { 
      display: none;
      padding: 30px 5%;
    }
    #loading:empty { display: none; }
  </style>
</head>

<body>
  <header class="site-topbar"><!-- 保持原有结构 --></header>

  <main>
    <div class="series-overview" id="seriesOverview">
      <!-- 动态生成系列卡片 -->
      <script>
        const seriesData = [
          {id:'a', name:'Series A', desc:'经典螺栓固定结构系列', img:'series-a.jpg'},
          {id:'b', name:'Series B', desc:'高端通颈连体工艺系列', img:'series-b.jpg'},
          {id:'c', name:'Series C', desc:'迷你便携式贝斯系列', img:'series-c.jpg'},
          {id:'d', name:'Series D', desc:'革命性人体工学设计', img:'series-d.jpg'}
        ];
        
        document.write(seriesData.map(series => `
          <a class="series-card" href="products.html?series=${series.id}">
            <img src="images/${series.img}" alt="${series.name}" loading="lazy">
            <div class="series-card-content">
              <h2>${series.name}</h2>
              <p>${series.desc}</p>
              <div class="series-card-cta">查看产品</div>
            </div>
          </a>
        `).join(''));
      </script>
    </div>

    <div class="model-list" id="modelList">
      <a href="products.html" class="back-button">← 返回系列总览</a>
      <div id="loading"></div>
      <div class="models-container" id="modelsContainer"></div>
    </div>
  </main>

  <footer class="site-bottombar" id="footerToTop"><!-- 保持原结构 --></footer>

  <script src="/js/main.js"></script>
  <script>
    // 强化版加载逻辑
    const loadSeries = () => {
      const { search } = window.location;
      if (!search.includes('series=')) return;

      document.getElementById('seriesOverview').style.display = 'none';
      const modelList = document.getElementById('modelList');
      modelList.style.display = 'block';
      
      const seriesId = new URLSearchParams(search).get('series');
      const loadingEl = document.getElementById('loading');
      loadingEl.textContent = `正在加载 ${seriesId.toUpperCase()} 系列...`;

      fetch(`data/${seriesId}.json?nc=${Date.now()}`)
        .then(res => res.ok ? res.json() : Promise.reject(res.status))
        .then(data => {
          loadingEl.textContent = '';
          document.getElementById('modelsContainer').innerHTML = `
            <h1>${data.name}</h1>
            ${data.models.map(m => `
              <div class="model-card">
                <img src="${m.image}" alt="${m.name}" loading="lazy">
                <h3>${m.name}</h3>
                <p>${m.features}</p>
                <ul>${m.specs.map(s => `<li>${s}</li>`).join('')}</ul>
              </div>
            `).join('')}
          `;
        })
        .catch(err => {
          loadingEl.innerHTML = `⚠️ 加载失败: <small>${err}</small>`;
          console.error('Fetch Error:', err);
        });
    };

    // 初始化执行
    document.addEventListener('DOMContentLoaded', loadSeries);
    
    // 历史记录变化时重新加载
    window.addEventListener('popstate', loadSeries);
  </script>
</body>
</html>